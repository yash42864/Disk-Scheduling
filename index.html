<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disk Scheduling Visualizer with AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.pyodide.io/v0.23.4/full/pyodide.js"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Header with Dark Mode Toggle -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Disk Scheduling Visualizer with AI</h1>
            <button id="themeToggle" class="p-2 rounded bg-gray-200 dark:bg-gray-700">
                <span class="dark:hidden">üåô</span>
                <span class="hidden dark:inline">‚òÄÔ∏è</span>
            </button>
        </div>

        <!-- Input Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div>
                <label class="block text-gray-700 dark:text-gray-200 mb-2">Cylinder Sequence</label>
                <input id="sequenceInput" type="text" 
                       class="w-full p-2 border rounded dark:bg-gray-800 dark:text-white"
                       placeholder="e.g., 98,183,37,122,14,124,65,67"
                       draggable="true">
            </div>
            <div>
                <label class="block text-gray-700 dark:text-gray-200 mb-2">Head Position</label>
                <input id="headInput" type="number" min="0" max="199" 
                       class="w-full p-2 border rounded dark:bg-gray-800 dark:text-white"
                       value="50">
                <input id="headSlider" type="range" min="0" max="199" value="50" 
                       class="w-full mt-2">
            </div>
            <div class="flex items-end">
                <button id="startBtn" class="w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Start Simulation
                </button>
                <button id="randomBtn" class="ml-2 p-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                    Random
                </button>
            </div>
        </div>

        <!-- AI Recommendation -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded shadow mb-6">
            <h2 class="text-xl font-semibold mb-4 dark:text-white">AI Recommendation</h2>
            <p id="aiRecommendation" class="dark:text-white">Enter a sequence and click Start to see the AI's recommended algorithm.</p>
        </div>

        <!-- Visualization Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
                <h2 class="text-xl font-semibold mb-4 dark:text-white">FCFS Visualization</h2>
                <canvas id="fcfsCanvas" height="200"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
                <h2 class="text-xl font-semibold mb-4 dark:text-white">SSTF Visualization</h2>
                <canvas id="sstfCanvas" height="200"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
                <h2 class="text-xl font-semibold mb-4 dark:text-white">SCAN Visualization</h2>
                <canvas id="scanCanvas" height="200"></canvas>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
                <h2 class="text-xl font-semibold mb-4 dark:text-white">C-SCAN Visualization</h2>
                <canvas id="cscanCanvas" height="200"></canvas>
            </div>
        </div>

        <!-- Comparison Dashboard -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded shadow">
            <h2 class="text-xl font-semibold mb-4 dark:text-white">Performance Comparison</h2>
            <canvas id="comparisonChart"></canvas>
            <div id="metrics" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"></div>
        </div>
    </div>

    <script>
        // Load Pyodide and Python script
        async function loadPyodideAndRun() {
            let pyodide = await loadPyodide();
            await pyodide.loadPackage(['scikit-learn', 'numpy']);
            await pyodide.runPythonAsync(`
import js
with open('main.py', 'w') as f:
    f.write('''${await fetch('main.py').then(res => res.text())}''')
`);
            return pyodide;
        }

        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        });
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');

        // Input Handling
        const sequenceInput = document.getElementById('sequenceInput');
        const headInput = document.getElementById('headInput');
        const headSlider = document.getElementById('headSlider');
        const startBtn = document.getElementById('startBtn');
        const randomBtn = document.getElementById('randomBtn');

        headInput.addEventListener('input', () => headSlider.value = headInput.value);
        headSlider.addEventListener('input', () => headInput.value = headSlider.value);

        // Drag and Drop
        sequenceInput.addEventListener('dragover', (e) => e.preventDefault());
        sequenceInput.addEventListener('drop', (e) => {
            e.preventDefault();
            const text = e.dataTransfer.getData('text');
            sequenceInput.value = text;
        });

        // Random Sequence Generator
        randomBtn.addEventListener('click', () => {
            const randomSeq = Array.from({length: 8}, () => Math.floor(Math.random() * 200));
            sequenceInput.value = randomSeq.join(',');
        });

        // Disk Scheduling Algorithms
        function fcfs(requests, head) {
            const sequence = [head, ...requests];
            let totalSeek = 0;
            for (let i = 1; i < sequence.length; i++) {
                totalSeek += Math.abs(sequence[i] - sequence[i-1]);
            }
            return { sequence, totalSeek };
        }

        function sstf(requests, head) {
            let remaining = [...requests];
            const sequence = [head];
            let totalSeek = 0;
            let current = head;

            while (remaining.length > 0) {
                let minDist = Infinity;
                let nextIdx = 0;
                for (let i = 0; i < remaining.length; i++) {
                    const dist = Math.abs(current - remaining[i]);
                    if (dist < minDist) {
                        minDist = dist;
                        nextIdx = i;
                    }
                }
                totalSeek += minDist;
                current = remaining[nextIdx];
                sequence.push(current);
                remaining.splice(nextIdx, 1);
            }
            return { sequence, totalSeek };
        }

        function scan(requests, head, direction = 'right') {
            let sequence = [];
            let totalSeek = 0;
            let sortedRequests = [...requests].sort((a, b) => a - b);
            let current = head;

            if (direction === 'right') {
                sequence.push(current);
                const right = sortedRequests.filter(x => x >= current);
                const left = sortedRequests.filter(x => x < current).reverse();
                for (let pos of right) {
                    totalSeek += Math.abs(current - pos);
                    current = pos;
                    sequence.push(current);
                }
                if (left.length > 0) {
                    totalSeek += Math.abs(current - 199);
                    current = 199;
                    sequence.push(current);
                    for (let pos of left) {
                        totalSeek += Math.abs(current - pos);
                        current = pos;
                        sequence.push(current);
                    }
                }
            } else {
                sequence.push(current);
                const left = sortedRequests.filter(x => x <= current).reverse();
                const right = sortedRequests.filter(x > current);
                for (let pos of left) {
                    totalSeek += Math.abs(current - pos);
                    current = pos;
                    sequence.push(current);
                }
                if (right.length > 0) {
                    totalSeek += Math.abs(current - 0);
                    current = 0;
                    sequence.push(current);
                    for (let pos of right) {
                        totalSeek += Math.abs(current - pos);
                        current = pos;
                        sequence.push(current);
                    }
                }
            }
            return { sequence, totalSeek };
        }

        function cscan(requests, head) {
            let sequence = [];
            let totalSeek = 0;
            let sortedRequests = [...requests].sort((a, b) => a - b);
            let current = head;

            sequence.push(current);
            const right = sortedRequests.filter(x => x >= current);
            const left = sortedRequests.filter(x => x < current);

            for (let pos of right) {
                totalSeek += Math.abs(current - pos);
                current = pos;
                sequence.push(current);
            }
            if (left.length > 0) {
                totalSeek += Math.abs(current - 199);
                current = 199;
                sequence.push(current);
                totalSeek += Math.abs(199 - 0);
                current = 0;
                sequence.push(current);
                for (let pos of left.sort((a, b) => a - b)) {
                    totalSeek += Math.abs(current - pos);
                    current = pos;
                    sequence.push(current);
                }
            }
            return { sequence, totalSeek };
        }

        // Animation with Chart.js
        function animateDisk(canvasId, sequence, title) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            if (canvas.chart) canvas.chart.destroy();

            canvas.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sequence.map((_, i) => `Step ${i}`),
                    datasets: [{
                        label: title,
                        data: sequence,
                        borderColor: '#3B82F6',
                        fill: false,
                        tension: 0,
                        pointRadius: 4,
                        pointBackgroundColor: '#EF4444'
                    }]
                },
                options: {
                    animation: {
                        duration: 1000,
                        easing: 'linear'
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 200,
                            title: { display: true, text: 'Cylinder' }
                        },
                        x: {
                            title: { display: true, text: 'Step' }
                        }
                    }
                }
            });

            // Step-by-step animation
            let step = 0;
            function animateStep() {
                if (step < sequence.length) {
                    canvas.chart.data.datasets[0].data = sequence.slice(0, step + 1);
                    canvas.chart.data.labels = sequence.slice(0, step + 1).map((_, i) => `Step ${i}`);
                    canvas.chart.update();
                    step++;
                    setTimeout(animateStep, 500);
                }
            }
            animateStep();
        }

        // Comparison Chart
        let comparisonChart;
        function updateComparisonChart(results) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (comparisonChart) comparisonChart.destroy();

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['FCFS', 'SSTF', 'SCAN', 'C-SCAN'],
                    datasets: [{
                        label: 'Total Seek Time',
                        data: [
                            results.fcfs.totalSeek,
                            results.sstf.totalSeek,
                            results.scan.totalSeek,
                            results.cscan.totalSeek
                        ],
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Seek Time' } }
                    }
                }
            });
        }

        // Main Simulation
        startBtn.addEventListener('click', async () => {
            const requests = sequenceInput.value.split(',').map(Number).filter(n => !isNaN(n) && n >= 0 && n < 200);
            const head = parseInt(headInput.value);

            if (requests.length === 0) {
                alert('Please enter a valid sequence');
                return;
            }

            // Run Disk Scheduling Algorithms
            const fcfsResult = fcfs(requests, head);
            const sstfResult = sstf(requests, head);
            const scanResult = scan(requests, head, 'right');
            const cscanResult = cscan(requests, head);

            // Animate Visualizations
            animateDisk('fcfsCanvas', fcfsResult.sequence, 'FCFS');
            animateDisk('sstfCanvas', sstfResult.sequence, 'SSTF');
            animateDisk('scanCanvas', scanResult.sequence, 'SCAN');
            animateDisk('cscanCanvas', cscanResult.sequence, 'C-SCAN');

            // Update Comparison Chart
            updateComparisonChart({
                fcfs: fcfsResult,
                sstf: sstfResult,
                scan: scanResult,
                cscan: cscanResult
            });

            // Update Metrics
            const metricsDiv = document.getElementById('metrics');
            metricsDiv.innerHTML = `
                <div class="dark:text-white">
                    <h3 class="font-semibold">FCFS Metrics</h3>
                    <p>Total Seek Time: ${fcfsResult.totalSeek}</p>
                    <p>Average Seek Time: ${(fcfsResult.totalSeek / requests.length).toFixed(2)}</p>
                    <p>Cylinder Movements: ${requests.length}</p>
                </div>
                <div class="dark:text-white">
                    <h3 class="font-semibold">SSTF Metrics</h3>
                    <p>Total Seek Time: ${sstfResult.totalSeek}</p>
                    <p>Average Seek Time: ${(sstfResult.totalSeek / requests.length).toFixed(2)}</p>
                    <p>Cylinder Movements: ${requests.length}</p>
                </div>
                <div class="dark:text-white">
                    <h3 class="font-semibold">SCAN Metrics</h3>
                    <p>Total Seek Time: ${scanResult.totalSeek}</p>
                    <p>Average Seek Time: ${(scanResult.totalSeek / requests.length).toFixed(2)}</p>
                    <p>Cylinder Movements: ${requests.length}</p>
                </div>
                <div class="dark:text-white">
                    <h3 class="font-semibold">C-SCAN Metrics</h3>
                    <p>Total Seek Time: ${cscanResult.totalSeek}</p>
                    <p>Average Seek Time: ${(cscanResult.totalSeek / requests.length).toFixed(2)}</p>
                    <p>Cylinder Movements: ${requests.length}</p>
                </div>
            `;

            // Run AI Prediction
            const pyodide = await loadPyodideAndRun();
            const prediction = await pyodide.runPythonAsync(`
from main import predict_optimal_algorithm
predict_optimal_algorithm(${JSON.stringify(requests)}, ${head})
            `);
            document.getElementById('aiRecommendation').textContent = 
                `AI recommends: ${prediction} (based on sequence analysis)`;
        });
    </script>
</body>
</html>
